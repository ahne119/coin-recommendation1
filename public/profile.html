<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로필 - 코인 추천 커뮤니티</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>프로필 페이지</h1>
            <nav>
                <ul>
                    <li><a href="index.html">홈</a></li>
                    <li><a href="board.html">게시판</a></li>
                    <li><a href="realtime.html">실시간 추천</a></li> <!-- 실시간 추천 메뉴 추가 -->
                    <li><a href="profile.html">프로필</a></li>
                    <li id="login-item"><a href="login.html">로그인</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="container">
            <h2>회원 정보</h2>
            <p>닉네임: <span id="nickname">불러오는 중...</span></p>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 코인 추천 커뮤니티</p>
            <a href="index.html">홈으로 돌아가기</a>
        </div>
    </footer>
    

    <!-- 사용자 정보 불러오는 fetch 코드 -->
    <script>
        fetch('/get-user')
            .then(response => {
                if (!response.ok) {
                    throw new Error('서버에서 오류가 발생했습니다.');
                }
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.includes("application/json")) {
                    return response.json();
                } else {
                    throw new Error('JSON 응답이 아닙니다.');
                }
            })
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    window.location.href = '/login.html';
                } else {
                    document.getElementById('nickname').innerText = data.nickname;
                }
            })
            .catch(err => {
                console.error('프로필 정보 불러오기 실패:', err);
                alert('프로필을 불러오는 데 실패했습니다.');
            });

            fetch('/get-user')
            .then(response => response.json())
            .then(data => {
                const loginItem = document.getElementById('login-item');
                const adminItem = document.getElementById('admin-item');

                if (data.nickname) {
                    loginItem.innerHTML = `<span>${data.nickname}님 | </span><a href="/logout">로그아웃</a>`;
                    if (data.role === 'admin') {
                        adminItem.style.display = 'inline-block';
                    }
                }
            })
            .catch(err => {
                console.error('로그인 상태 확인 실패:', err);
            });
    </script>
</body>
</html>
